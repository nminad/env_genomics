#!/bin/bash

REF=/cluster/scratch/nminadakis/Bdis_REF/Bdistachyon_556_v3.0.fa

ID=($(for i in /cluster/scratch/nminadakis/*1.fq.gz; do echo $(basename ${i%_*}); done))

for IND in ${ID[@]};

do
	# declare variables
	FORWARD=/cluster/scratch/nminadakis/${IND}_1.fq.gz
	REVERSE=/cluster/scratch/nminadakis/${IND}_2.fq.gz
	OUTPUT=/cluster/scratch/nminadakis/${IND}_sort.bam
	SAMPLE=$( echo ${IND} | sed 's/_.*//')

	# then mapping and sort
	echo "mapping $IND with bwa"
	bwa mem -M -R "@RG\tID:$IND\tSM:$SAMPLE\tPL:ILLUMINA\tLB:NA\tPI:NA" -t 16 $REF $FORWARD $REVERSE | samtools view -b | samtools sort -T ${IND} > $OUTPUT
	# echo $FORWARD $REVERSE $OUTPUT $SAMPLE $IND
done

for BAM in *.rmd.bam; do gatk --java-options "-Xmx8G" HaplotypeCaller --native-pair-hmm-threads 28 -R $REF -I $BAM -O $(basename ${BAM%%.*}).g.vcf.gz -ERC GVCF; done

gatk CombineGVCFs -R $REF \
-V 1a_29_12.bam.raw.snps.indels.g.vcf.gz \
-V 1a_29_14.bam.raw.snps.indels.g.vcf.gz \
-V 1a_29_27.bam.raw.snps.indels.g.vcf.gz \
-V 1a_30_14.bam.raw.snps.indels.g.vcf.gz \
-V 1a_30_24.bam.raw.snps.indels.g.vcf.gz \
-V 1a_30_26.bam.raw.snps.indels.g.vcf.gz \
-V 1a_30_2.bam.raw.snps.indels.g.vcf.gz \
-V 1a_31_2.bam.raw.snps.indels.g.vcf.gz \
-V 1a_31_6.bam.raw.snps.indels.g.vcf.gz \
-V 1a_32_10.bam.raw.snps.indels.g.vcf.gz \
-V 1a_32_12.bam.raw.snps.indels.g.vcf.gz \
-V 1a_32_5.bam.raw.snps.indels.g.vcf.gz \
-V 1c_25_14.bam.raw.snps.indels.g.vcf.gz \
-V 1c_25_15.bam.raw.snps.indels.g.vcf.gz \
-V 1c_25_7.bam.raw.snps.indels.g.vcf.gz \
-V 1c_26_3.bam.raw.snps.indels.g.vcf.gz \
-V 1c_26_4.bam.raw.snps.indels.g.vcf.gz \
-V 1c_27_15.bam.raw.snps.indels.g.vcf.gz \
-V 1c_27_8.bam.raw.snps.indels.g.vcf.gz \
-V 1c_28_1.bam.raw.snps.indels.g.vcf.gz \
-V 1c_28_2.bam.raw.snps.indels.g.vcf.gz \
-V 1c_34_1.bam.raw.snps.indels.g.vcf.gz \
-V 1c_34_25.bam.raw.snps.indels.g.vcf.gz \
-V 1c_35_1.bam.raw.snps.indels.g.vcf.gz \
-V 1c_35_7.bam.raw.snps.indels.g.vcf.gz \
-V 2_14_13.bam.raw.snps.indels.g.vcf.gz \
-V 2_14_15.bam.raw.snps.indels.g.vcf.gz \
-V 2_14_20.bam.raw.snps.indels.g.vcf.gz \
-V 2_14_25.bam.raw.snps.indels.g.vcf.gz \
-V 2_1_7.bam.raw.snps.indels.g.vcf.gz \
-V 2_20_16.bam.raw.snps.indels.g.vcf.gz \
-V 2_5_10.bam.raw.snps.indels.g.vcf.gz \
-V 2_5_21.bam.raw.snps.indels.g.vcf.gz \
-V 2_8_1.bam.raw.snps.indels.g.vcf.gz \
-V 2_8_3.bam.raw.snps.indels.g.vcf.gz \
-V 2_9_1.bam.raw.snps.indels.g.vcf.gz \
-V 2_9_9.bam.raw.snps.indels.g.vcf.gz \
-V 2B.g.vcf.gz \
-V 3_38_12.bam.raw.snps.indels.g.vcf.gz \
-V 3_38_19.bam.raw.snps.indels.g.vcf.gz \
-V 3_40_4.bam.raw.snps.indels.g.vcf.gz \
-V 3_41_1.bam.raw.snps.indels.g.vcf.gz \
-V 3_41_3.bam.raw.snps.indels.g.vcf.gz \
-V 3_42_11.bam.raw.snps.indels.g.vcf.gz \
-V 3_42_19.bam.raw.snps.indels.g.vcf.gz \
-V 3_54_19.bam.raw.snps.indels.g.vcf.gz \
-V 3_54_3.bam.raw.snps.indels.g.vcf.gz \
-V 3_55_13.bam.raw.snps.indels.g.vcf.gz \
-V 3_55_27.bam.raw.snps.indels.g.vcf.gz \
-V 3A.g.vcf.gz \
-V 3G.g.vcf.gz \
-V 3i.g.vcf.gz \
-V 4_36_22.bam.raw.snps.indels.g.vcf.gz \
-V 4_45_19.bam.raw.snps.indels.g.vcf.gz \
-V 4_47_16.bam.raw.snps.indels.g.vcf.gz \
-V 4_47_25.bam.raw.snps.indels.g.vcf.gz \
-V 4_49_22.bam.raw.snps.indels.g.vcf.gz \
-V 4_49_26.bam.raw.snps.indels.g.vcf.gz \
-V 4_51_22.bam.raw.snps.indels.g.vcf.gz \
-V 4_52_15.bam.raw.snps.indels.g.vcf.gz \
-V 4_52_6.bam.raw.snps.indels.g.vcf.gz \
-V AB1_4.g.vcf.gz \
-V AB3_3.g.vcf.gz \
-V ABR2.rdup.ds_0.27.bam.raw.snps.indels.g.vcf.gz \
-V ABR3.rdup.ds_0.28.bam.raw.snps.indels.g.vcf.gz \
-V ABR4.rdup.ds_0.24.bam.raw.snps.indels.g.vcf.gz \
-V ABR5.rdup.ds_0.31.bam.raw.snps.indels.g.vcf.gz \
-V ABR6.rdup.ds_0.53.bam.raw.snps.indels.g.vcf.gz \
-V ABR7.rdup.ds_0.26.bam.raw.snps.indels.g.vcf.gz \
-V ABR8.g.vcf.gz \
-V ABR9.rdup.ds_0.58.bam.raw.snps.indels.g.vcf.gz \
-V Adi-10.rdup.ds_0.6.bam.raw.snps.indels.g.vcf.gz \
-V Adi-12.rdup.ds_0.51.bam.raw.snps.indels.g.vcf.gz \
-V Adi-15.g.vcf.gz \
-V Adi-2.rdup.ds_0.63.bam.raw.snps.indels.g.vcf.gz \
-V Adi-9.g.vcf.gz \
-V AL1A.g.vcf.gz \
-V AL2E.g.vcf.gz \
-V AL2F.g.vcf.gz \
-V Arn1.rdup.ds_0.25.bam.raw.snps.indels.g.vcf.gz \
-V Bd1-1.rdup.ds_0.56.bam.raw.snps.indels.g.vcf.gz \
-V Bd18-1.rdup.ds_0.26.bam.raw.snps.indels.g.vcf.gz \
-V Bd21-3.rdup.ds_0.83.bam.raw.snps.indels.g.vcf.gz \
-V Bd21.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Bd2-3.rdup.ds_0.65.bam.raw.snps.indels.g.vcf.gz \
-V Bd29-1.rdup.ds_0.25.bam.raw.snps.indels.g.vcf.gz \
-V Bd30-1.rdup.ds_0.42.bam.raw.snps.indels.g.vcf.gz \
-V Bd3-1.rdup.ds_0.88.bam.raw.snps.indels.g.vcf.gz \
-V BdTR10C.rdup.ds_0.56.bam.raw.snps.indels.g.vcf.gz \
-V BdTR10D.g.vcf.gz \
-V BdTR11A.rdup.ds_0.79.bam.raw.snps.indels.g.vcf.gz \
-V BdTR11G.rdup.ds_0.61.bam.raw.snps.indels.g.vcf.gz \
-V BdTR11I.rdup.ds_0.38.bam.raw.snps.indels.g.vcf.gz \
-V BdTR11Ε.g.vcf.gz \
-V BdTR12c.rdup.ds_0.91.bam.raw.snps.indels.g.vcf.gz \
-V BdTR12Β.g.vcf.gz \
-V BdTR13a.rdup.ds_0.34.bam.raw.snps.indels.g.vcf.gz \
-V BdTR13C.rdup.ds_0.81.bam.raw.snps.indels.g.vcf.gz \
-V BdTR13Β.g.vcf.gz \
-V BdTR13Ν.g.vcf.gz \
-V BdTR2B.rdup.ds_0.3.bam.raw.snps.indels.g.vcf.gz \
-V BdTR2G.rdup.ds_0.7.bam.raw.snps.indels.g.vcf.gz \
-V BdTR3Μ.g.vcf.gz \
-V BdTR5I.rdup.ds_0.88.bam.raw.snps.indels.g.vcf.gz \
-V BdTR7a.rdup.ds_0.39.bam.raw.snps.indels.g.vcf.gz \
-V BdTR8i.rdup.ds_0.28.bam.raw.snps.indels.g.vcf.gz \
-V BdTR9K.rdup.ds_1.07.bam.raw.snps.indels.g.vcf.gz \
-V BdTR9Μ.g.vcf.gz \
-V Bi1.g.vcf.gz \
-V Bi2.g.vcf.gz \
-V Cb14.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cb23.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cef2.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Chi2.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Chi3.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cm10.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cm12.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cm13.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cm16.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cm18.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cm2.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cm3.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cm4.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cm7.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cro13.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cro24.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Cro5.rdup.bam.raw.snps.indels.g.vcf.gz \
-V CU1_6.g.vcf.gz \
-V CU5_5.g.vcf.gz \
-V Foz1.rdup.ds_0.32.bam.raw.snps.indels.g.vcf.gz \
-V G30i2.g.vcf.gz \
-V G31i4.g.vcf.gz \
-V G32i2.g.vcf.gz \
-V G33i4.g.vcf.gz \
-V G33i6.g.vcf.gz \
-V G34i2.g.vcf.gz \
-V G34i6.g.vcf.gz \
-V Gaz-1.g.vcf.gz \
-V Gaz-7.g.vcf.gz \
-V Gaz-8.rdup.ds_0.58.bam.raw.snps.indels.g.vcf.gz \
-V Ges19.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Ges1.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Ges26.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Ges30.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Ges5.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Gj1.g.vcf.gz \
-V Gj2.g.vcf.gz \
-V Gj3.g.vcf.gz \
-V Gj4.g.vcf.gz \
-V GR3_6.g.vcf.gz \
-V GU5_1.g.vcf.gz \
-V HU3_4.g.vcf.gz \
-V J4_3.g.vcf.gz \
-V J6_2.g.vcf.gz \
-V Jer1.rdup.ds_0.28.bam.raw.snps.indels.g.vcf.gz \
-V Kah-1.rdup.ds_1.15.bam.raw.snps.indels.g.vcf.gz \
-V Kah-5.rdup.ds_0.52.bam.raw.snps.indels.g.vcf.gz \
-V Kah-6.g.vcf.gz \
-V Ko2.g.vcf.gz \
-V Ko3.g.vcf.gz \
-V Koz-1.rdup.ds_0.37.bam.raw.snps.indels.g.vcf.gz \
-V Koz-2.g.vcf.gz \
-V Koz-3.rdup.ds_0.97.bam.raw.snps.indels.g.vcf.gz \
-V Koz-5.g.vcf.gz \
-V Lam13.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lam6.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb11.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb13.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb16.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb18.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb1.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb21.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb23.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb3.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb7.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Lb8.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Leo2.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Leo7.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Leo8.rdup.bam.raw.snps.indels.g.vcf.gz \
-V LPA3.g.vcf.gz \
-V Luc1.rdup.ds_0.33.bam.raw.snps.indels.g.vcf.gz \
-V Mca10.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mca12.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mca16.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mca18.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mca19.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mca23.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mca26.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mca7.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mcp2.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mcp7.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Meg1.g.vcf.gz \
-V Meg2.g.vcf.gz \
-V Meg3.g.vcf.gz \
-V Meg4.g.vcf.gz \
-V Meg5.g.vcf.gz \
-V Meg6.g.vcf.gz \
-V Meg7.g.vcf.gz \
-V Meg8.g.vcf.gz \
-V Mig3.rdup.ds_0.26.bam.raw.snps.indels.g.vcf.gz \
-V Mon3.rdup.ds_0.34.bam.raw.snps.indels.g.vcf.gz \
-V MonSV10.g.vcf.gz \
-V MonSV11.g.vcf.gz \
-V MonSV12.g.vcf.gz \
-V MonSV13.g.vcf.gz \
-V MonSV14.g.vcf.gz \
-V MonSV15.g.vcf.gz \
-V MonSV1.g.vcf.gz \
-V MonSV2.g.vcf.gz \
-V MonSV3.g.vcf.gz \
-V MonSV4.g.vcf.gz \
-V MonSV5.g.vcf.gz \
-V MonSV6.g.vcf.gz \
-V MonSV7.g.vcf.gz \
-V MonSV8.g.vcf.gz \
-V MonSV9.g.vcf.gz \
-V Msa11.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Msa16.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Msa27.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Msa6.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Msa9.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Mur1.rdup.ds_0.28.bam.raw.snps.indels.g.vcf.gz \
-V Myt1.g.vcf.gz \
-V Myt2.g.vcf.gz \
-V Myt3.g.vcf.gz \
-V Myt4.g.vcf.gz \
-V Myt5.g.vcf.gz \
-V Per1.rdup.ds_0.4.bam.raw.snps.indels.g.vcf.gz \
-V Pob1.rdup.ds_0.47.bam.raw.snps.indels.g.vcf.gz \
-V Ram6.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Ren14.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Ren19.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Ren22.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Ren4.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Ren5.rdup.bam.raw.snps.indels.g.vcf.gz \
-V RON2.rdup.ds_0.29.bam.raw.snps.indels.g.vcf.gz \
-V S11A.g.vcf.gz \
-V S11B.g.vcf.gz \
-V S11D.g.vcf.gz \
-V S12B.g.vcf.gz \
-V S16D.g.vcf.gz \
-V S17D.g.vcf.gz \
-V S19A.g.vcf.gz \
-V S22B.g.vcf.gz \
-V S6D.g.vcf.gz \
-V S6E.g.vcf.gz \
-V S8iiC.rdup.ds_0.26.bam.raw.snps.indels.g.vcf.gz \
-V San11.rdup.bam.raw.snps.indels.g.vcf.gz \
-V San12.rdup.bam.raw.snps.indels.g.vcf.gz \
-V San15.rdup.bam.raw.snps.indels.g.vcf.gz \
-V San24.rdup.bam.raw.snps.indels.g.vcf.gz \
-V San25.rdup.bam.raw.snps.indels.g.vcf.gz \
-V San26.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap31.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap40.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap44.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap47.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap49.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap57.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap58.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap59.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap61.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap64.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap66.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap68.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sap7.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sg2_1.g.vcf.gz \
-V Shf16.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Shf23.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Shf28.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Shf8.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Siat10.g.vcf.gz \
-V Siat11.g.vcf.gz \
-V Siat12.g.vcf.gz \
-V Siat13.g.vcf.gz \
-V Siat14.g.vcf.gz \
-V Siat15.g.vcf.gz \
-V Siat1.g.vcf.gz \
-V Siat2.g.vcf.gz \
-V Siat3.g.vcf.gz \
-V Siat4.g.vcf.gz \
-V Siat5.g.vcf.gz \
-V Siat6.g.vcf.gz \
-V Siat7.g.vcf.gz \
-V Siat8.g.vcf.gz \
-V Siat9.g.vcf.gz \
-V Sig2.rdup.ds_0.3.bam.raw.snps.indels.g.vcf.gz \
-V Spm16.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Spm22.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sul2.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sul4.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Sul5.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Syv1.g.vcf.gz \
-V Syv2.g.vcf.gz \
-V Syv3.g.vcf.gz \
-V Tar12.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Tar1.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Tek-2.rdup.ds_1.15.bam.raw.snps.indels.g.vcf.gz \
-V Tek-4.rdup.ds_1.25.bam.raw.snps.indels.g.vcf.gz \
-V Tek-9.g.vcf.gz \
-V Tso17.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Tso18.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Tso22.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Tso3.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Tso8.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Uni2.rdup.ds_0.25.bam.raw.snps.indels.g.vcf.gz \
-V Veg10.g.vcf.gz \
-V Veg11.g.vcf.gz \
-V Veg12.g.vcf.gz \
-V Veg13.g.vcf.gz \
-V Veg14.g.vcf.gz \
-V Veg15.g.vcf.gz \
-V Veg1.g.vcf.gz \
-V Veg2.g.vcf.gz \
-V Veg3.g.vcf.gz \
-V Veg4.g.vcf.gz \
-V Veg5.g.vcf.gz \
-V Veg6.g.vcf.gz \
-V Veg7.g.vcf.gz \
-V Veg8.g.vcf.gz \
-V Veg9.g.vcf.gz \
-V Vif1.rdup.bam.raw.snps.indels.g.vcf.gz \
-V Vyt1.g.vcf.gz \
-V Vyt2.g.vcf.gz \
-V Vyt3.g.vcf.gz \
-V Z3_6.g.vcf.gz
-O Bdis332.g.vcf.gz

gatk GenotypeGVCFs --allow-old-rms-mapping-quality-annotation-data -R $REF -V Bdis332.g.vcf.gz -O Bdis332.vcf.gz

gatk SelectVariants -select-type SNP -V cretan_test.vcf.gz -O cretan_test_SNP.vcf.gz
